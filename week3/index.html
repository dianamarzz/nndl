<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neural Network Design: The Gradient Puzzle</title>
    <!-- TensorFlow.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.17.0/dist/tf.min.js"></script>
    <style>
      :root {
        --bg-color: #0d1117;
        --card-bg: #161b22;
        --text-main: #e6edf3;
        --text-dim: #8b949e;
        --accent: #2f81f7;
        --accent-glow: #1f6feb;
        --success: #3fb950;
        --warning: #f7b731;
        --danger: #f85149;
        --border: #30363d;
        --border-radius: 8px;
        --canvas-size: 256px;
      }
      body {
        font-family: 'Segoe UI', 'Inter', -apple-system, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-main);
        margin: 0;
        padding: 24px 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
        line-height: 1.5;
      }
      h1 {
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 2rem;
        letter-spacing: -0.5px;
        background: linear-gradient(120deg, #79c0ff, #b794f4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-align: center;
      }
      .subhead {
        color: var(--text-dim);
        margin-top: 0;
        margin-bottom: 24px;
        text-align: center;
        max-width: 700px;
        font-style: italic;
      }
      .controls {
        background-color: var(--card-bg);
        padding: 20px 28px;
        border-radius: var(--border-radius);
        margin-bottom: 30px;
        display: flex;
        gap: 28px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
        box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        border: 1px solid var(--border);
      }
      .control-group {
        display: flex;
        gap: 12px;
        align-items: center;
        border-right: 1px solid var(--border);
        padding-right: 28px;
      }
      .control-group:last-child {
        border-right: none;
        padding-right: 0;
      }
      button {
        padding: 8px 18px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        transition: 0.2s;
        background-color: #21262d;
        color: white;
        border: 1px solid #3d444d;
      }
      button:hover {
        background-color: #30363d;
        border-color: #8b949e;
      }
      .btn-train {
        background-color: var(--accent);
        border-color: var(--accent-glow);
      }
      .btn-auto {
        background-color: var(--success);
        border-color: #2ea043;
      }
      .btn-reset {
        background-color: var(--danger);
        border-color: #d73a49;
      }
      .btn-stop {
        background-color: var(--warning);
        border-color: #f0b429;
        color: #0d1117;
      }
      .arch-selector {
        display: flex;
        gap: 16px;
        font-size: 0.95rem;
      }
      .arch-selector label {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        background: #0d1117;
        border-radius: 20px;
        border: 1px solid var(--border);
        cursor: pointer;
      }
      .arch-selector input[type="radio"] {
        accent-color: var(--accent);
        width: 16px;
        height: 16px;
        margin: 0;
      }
      .grid-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 32px;
        width: 100%;
        max-width: 960px;
        margin-bottom: 24px;
      }
      .card {
        background-color: var(--card-bg);
        padding: 20px 16px;
        border-radius: var(--border-radius);
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        border: 1px solid var(--border);
      }
      .card h3 {
        margin: 0 0 6px 0;
        color: var(--accent);
        font-weight: 500;
        font-size: 1.2rem;
      }
      .card p {
        font-size: 0.8rem;
        color: var(--text-dim);
        margin: 0 0 14px 0;
        min-height: 32px;
      }
      canvas {
        border: 2px solid var(--border);
        image-rendering: crisp-edges;
        image-rendering: pixelated;
        width: var(--canvas-size);
        height: var(--canvas-size);
        background-color: #0a0c10;
        margin-bottom: 12px;
        border-radius: 4px;
      }
      .loss-display {
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
        font-size: 0.9rem;
        color: var(--success);
        background: #0d1117;
        padding: 6px 14px;
        border-radius: 20px;
        border: 1px solid #3d444d;
        width: fit-content;
      }
      #log-area {
        width: 100%;
        max-width: 960px;
        margin-top: 8px;
        padding: 16px 20px;
        background-color: #0a0c10;
        color: #7ee787;
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
        font-size: 0.85rem;
        border-radius: 6px;
        height: 110px;
        overflow-y: auto;
        border: 1px solid var(--border);
        line-height: 1.5;
        box-shadow: inset 0 0 8px #000;
      }
      .error {
        color: var(--danger);
      }
      .student-card {
        border: 2px solid var(--accent);
        box-shadow: 0 0 16px rgba(47, 129, 247, 0.2);
      }
      .todo-badge {
        background: #252a33;
        color: #f7b731;
        font-size: 0.7rem;
        padding: 2px 10px;
        border-radius: 12px;
        margin-left: 8px;
        font-weight: 600;
      }
      footer {
        margin-top: 24px;
        color: var(--text-dim);
        font-size: 0.8rem;
      }
    </style>
  </head>
  <body>
    <h1>üß© The Gradient Puzzle</h1>
    <div class="subhead">
      Mission: Rearrange noise ‚Üí smooth gradient. No new colors. No labels.
    </div>

    <div class="controls">
      <div class="control-group">
        <button id="btn-train" class="btn-train">‚èØÔ∏è Train 1 Step</button>
        <button id="btn-auto" class="btn-auto">‚ñ∂Ô∏è Auto Train (Start)</button>
        <button id="btn-reset" class="btn-reset">üîÑ Reset Weights</button>
      </div>

      <div class="control-group arch-selector">
        <strong style="color: var(--text-dim);">Projection:</strong>
        <label>
          <input type="radio" name="arch" value="compression" checked />
          <span>üßä Compression</span>
        </label>
        <label>
          <input type="radio" name="arch" value="transformation" />
          <span>üîÑ Transformation <span class="todo-badge">TODO-A</span></span>
        </label>
        <label>
          <input type="radio" name="arch" value="expansion" />
          <span>üöÄ Expansion <span class="todo-badge">TODO-A</span></span>
        </label>
      </div>
    </div>

    <div class="grid-container">
      <!-- Card 1: Fixed Input Noise -->
      <div class="card">
        <h3>üé≤ Input</h3>
        <p>Fixed Random Noise [16√ó16]</p>
        <canvas id="canvas-input" width="16" height="16"></canvas>
        <div class="loss-display">‚Äî</div>
      </div>

      <!-- Card 2: Baseline (MSE only) -->
      <div class="card">
        <h3>üìè Baseline</h3>
        <p>Compression ‚Ä¢ Loss: MSE only</p>
        <canvas id="canvas-baseline" width="16" height="16"></canvas>
        <div id="loss-baseline" class="loss-display">Loss: 0.00000</div>
      </div>

      <!-- Card 3: Student (Customizable) -->
      <div class="card student-card">
        <h3>üéØ Student</h3>
        <p>
          Arch: <span id="student-arch-label">Compression</span> ‚Ä¢ 
          Loss: <strong style="color: #f7b731;">Custom</strong>
          <span class="todo-badge">TODO-B</span>
        </p>
        <canvas id="canvas-student" width="16" height="16"></canvas>
        <div id="loss-student" class="loss-display">Loss: 0.00000</div>
      </div>
    </div>

    <div id="log-area">
      ‚ö° Initialized. Select architecture or edit TODOs in app.js.<br>
      ‚ñ∂Ô∏è Train a few steps ‚Äì baseline reconstructs noise; student can learn gradient with custom loss.
    </div>
    <footer style="text-align: left; width: 100%; max-width: 960px;">
      ‚ö†Ô∏è Constraint: Output histogram ‚âà Input histogram. You rearrange, not repaint.
    </footer>
    <script src="app.js"></script>
  </body>
</html>